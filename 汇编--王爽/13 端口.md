# 14 端口

在PC机中，和CPU通过总线相连的芯片有：

（1）各种存储器；

（2）各种接口卡（网卡/显卡等）上的接口芯片；

（3）主板上的接口芯片，CPU通过他们对外部设备进行访问；

（4）其他芯片，用来存储系统信息，活进行相关的输入输出。

这些芯片都有一组可以由CPU读写的寄存器，虽然它们在物理上处在不同的芯片，但是它们都和CPU通过总线相连，CPU通过控制总线对芯片所在的端口地址发出读写命令，进行读写操作。

8086CPU将这些寄存器都当作为端口，进行统一编址，建立了一个逻辑上的端口地址空间，8086CPU最多课定位64K（65536）个端口地址。

在进行端口访问时，CPU通过端口地址来定位端口，并且和内存地址一样，通过地址总线传输地址。

## 14.1 端口读写

由于编址方式的不同，对端口的读写不能用使用mov/pop等指令，端口的读写指令只有两条：`IN`和`OUT`。

在执行端口读取指令`IN 60h`时，与总线相关的操作如下：

（1）CPU通过地址线将地址将60h发出；

（2）CPU通过控制总线发出内存读命令，选中存储芯片，并通知他要从中读取数据；

（3）端口所在的接口芯片将60h端口中的数据通过数据总线送入CPU。

对0的端口进行读写时，只能使用al或者ax寄存器存放数据。

## 14.2 实验：访问 CMOS RAM芯片

CMOS RAM芯片介绍：

在CMS RAM芯片中，包含一个实时钟和一个有128个存储单元的RAM存储器，关机后其内部的实时钟还是可以正常工作的，RAM当中的信息不会丢失。这个芯片常保存计算机基本启动信息（如日期、时间、启动设置等）的芯片，其实CMOS是主板上的一块可读写的并行或串行FLASH芯片，是用来保存BIOS的硬件配置和用户对某些参数的设定。

这个芯片内部有两个端口，端口地址为70h和71h，CPU通过这两个端口来读写CMOS RAM。70h为地址端口，存放要访问的CMOS RAM单元的地址；71h位数据端口，存放从选定的CMOS RAM单元中读取的数据，或者要写入到其中的数据，其实CPU对CMOS RAM的读写分为两部分，比如说读CMOS RAM 的2号单元：

（1）将2送入端口70H；

（2）从71h读取2号单元的内容。

在CMOS RAM当中，存放着当前的时间：年、月、日、时、分、秒。这6个信息的长度都为1个字节，存放单元为：秒：0，分：2，时：4，日：7，月：8，年：9，这些数据都以BCD码的方式存放。

实验内容：读取系统事件输出到屏幕。
