# 1 引导操作系统启动

本章主要学习linux 0.11源码，boot/目录下的三个汇编代码。

bootsect.s和setup.s是运行在16位的实模式，head.s是运行在32位的保护模式。

系统启动时，执行的程序顺序如下：
![img1-1](img/1-1.jpg)

## 1.1 总体流程

Linux操作系统上电启动时，80x86结构的CPU将自动进入实模式，并且从0xFFFF0（这个地址一般写死在BIOS ROM中）处开始自动执行代码。

这个地址开始执行的是系统的BIOS代码，进行某些系统检查，并且在物理地址0处开始初始化中断向量。

此后，他将启动设备的第一个扇区（引导扇区，512B）读入内存0x7C00处，并且跳转到这个地方开始执行。这个地方的代码就是boot/bootsect.s代码，使用的是8086汇编语言。本部分程序会将自己从内存地址0x7C00处移动到0x9000处，并从启动设备上读入后续2KB的代码(boot/setup.s)，到内存0x90200处。

在setup.s程序中，会将内核的system模块读入到0x1000处，因为当时的system模块(head.s，main.c)不会超过0x80000字节大小。

head.s中，会完成进行实模式的相关设置，并进入实模式。最终执行init/main.c中的main程序。

这样子一顿操作之后，内核代码在内存位置中的移动如下：
![img/1-2](img/1-2.jpg)
