# C语言嵌入汇编

在内核代码中，大量使用了内嵌汇编来进行中断调用。

嵌入汇编的基本格式如下：

```c
asm("汇编语句"
    : 输出寄存器 //输出的存放寄存器
    : 输入寄存器 //函数入参，对应C变量or常数
    : 会被修改的寄存器) //不在输入/输出寄存器，但是执行过程中会被修改的寄存器
```

下面是一个实际的例子：

```C
#define _syscall0(type,name) \
type name(void) \
{ \
long __res; \
__asm__ volatile ( \
    "int $0x80" \           //汇编语句
    : "=a" (__res) \        //输入
    : "0" (__NR_##name)); \ //输入
if (__res >= 0) \
    return (type) __res; \
errno = -__res; \
return -1; \
}
```

例子中，`"=a"`的含义为：`=`--输入寄存器，`a`寄存器ax。`0`表示使用与上个寄存器相同的寄存器。

![img](img/0-0.png)
